<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>글 상세 보기</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h2>📄 글 상세 보기</h2>

    <div class="mb-3">
        <strong>제목:</strong> <span th:text="${post.title}"></span><br>
        <strong>작성자:</strong> <span th:text="${post.author.membername}"></span><br>
        <strong>내용:</strong>
        <div class="border p-3 mt-2" th:text="${post.content}"></div>
    </div>

    <!-- 첨부파일 -->
    <div class="mb-3">
        <strong>파일:</strong>
        <span th:if="${post.filename != null}">
            <a th:href="@{'/uploads/' + ${post.filename}}" th:text="${post.filename}"></a>
        </span>
        <span th:unless="${post.filename != null}">첨부된 파일 없음</span>
    </div>

    <!-- 수정/삭제 버튼 (작성자만 가능) -->
    <div class="mb-3" th:if="${loginMember != null and loginMember.id == post.author.id}">
        <a th:href="@{'/posts/' + ${post.id} + '/edit'}" class="btn btn-warning btn-sm">✏️ 수정</a>
        <a th:href="@{'/posts/' + ${post.id} + '/delete'}" class="btn btn-danger btn-sm"
           onclick="return confirm('정말 삭제할까요?');">❌ 삭제</a>
    </div>

    <!-- 로그인 정보 표시 -->
    <div class="mb-4" th:if="${loginMember != null}">
        <span class="me-3" th:text="'안녕하세요, ' + ${loginMember.membername} + '님!'"></span>
        <a href="/logout" class="btn btn-outline-secondary btn-sm">로그아웃</a>
    </div>

    <!-- 댓글 목록 -->
    <h4>💬 댓글</h4>
    <ul class="list-group mb-3">
        <li class="list-group-item" th:each="reply : ${replyList}">
            <strong th:text="${reply.author.membername}"></strong>:
            <span th:text="${reply.content}"></span>
            <br>
            <small th:text="${#temporals.format(reply.createdAt, 'yyyy-MM-dd HH:mm')}"></small>

            <!-- 댓글 수정/삭제 (작성자만) -->
            <div th:if="${loginMember != null and reply.author.id == loginMember.id}" class="mt-1">
                <a th:href="@{'/reply/' + ${reply.id} + '/edit'}" class="btn btn-sm btn-outline-primary">수정</a>
                <a th:href="@{'/reply/' + ${reply.id} + '/delete'}" class="btn btn-sm btn-outline-danger"
                   onclick="return confirm('댓글을 삭제하시겠습니까?')">삭제</a>
            </div>
        </li>
    </ul>

    <!-- 댓글 작성 폼 -->
    <div th:if="${loginMember != null}">
        <form th:action="@{'/posts/' + ${post.id} + '/reply'}" method="post" class="mb-4">
            <div class="mb-3">
                <textarea name="content" class="form-control" placeholder="댓글 작성..." required></textarea>
            </div>
            <button type="submit" class="btn btn-success">댓글 등록</button>
        </form>
    </div>
    <div th:if="${loginMember == null}" class="mb-3">
        <p class="text-muted">댓글을 작성하려면 <a href="/login">로그인</a> 해주세요.</p>
    </div>

    <a href="/posts" class="btn btn-secondary">← 목록</a>
    <a href="/mypage" class="btn btn-outline-primary">마이페이지</a>
</div>
</body>
</html>
